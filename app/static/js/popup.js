"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classPrivateFieldLooseBase(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var id=0;function _classPrivateFieldLooseKey(t){return"__private_"+id+++"_"+t}var Popup=function t(e){var a=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,t),this.state={parent:void 0,popup:void 0,body:void 0,bacground:void 0,description:void 0,data:{name:"",description:[],files:[]}},this.show=function(){var t=a.state,e=t.body,o=t.popup,s=t.bacground;e.appendChild(o),e.appendChild(s),_classPrivateFieldLooseBase(a,_createDescriptionBlock)[_createDescriptionBlock]()},this.hide=function(){var t=a.state,e=t.body,o=t.popup,s=t.bacground,i=t.data,n=t.parent;e.removeChild(o),e.removeChild(s),i.name||n.removeLastSection()},this.update=function(t){a.state.data=t,a.state.description=void 0,a.state.popup=_classPrivateFieldLooseBase(a,_createPopup)[_createPopup](t),_classPrivateFieldLooseBase(a,_createEvents)[_createEvents]()},Object.defineProperty(this,_createPopup,{writable:!0,value:function(t){var e=document.createElement("div");return e.classList="popup",e.id="popupId",e.innerHTML='\n\t\t\t<header class="popup__header">\n\t\t\t\t<div class="popup__header_text">Редактировать</div>\n\t\t\t\t<div class="popup__close" id="popupClose"></div>\n\t\t\t</header>\n\t\t\t<section class="popup__body">\n\t\t\t\t<div class="popup__section">\n\t\t\t\t\t<h2 class="popup__section_label">Имя секции</h2>\n\t\t\t\t\t<input class="card__redaction_text"\n\t\t\t\t\t\tid="popupNameSection"\n\t\t\t\t\t\ttype="text"\n\t\t\t\t\t\tmaxlength="50"\n\t\t\t\t\t\tplaceholder="Имя секции"\n\n\t\t\t\t\t\tvalue="'.concat(t.name||"",'"\n\t\t\t\t\t/>\n\t\t\t\t</div>\n\t\t\t\t<div class="popup__section">\n\t\t\t\t\t<h2 class="popup__section_label">Описание</h2>\n\t\t\t\t\t<div class="popup__section_description" id="popupDescription"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="popup__section">\n\t\t\t\t\t<h2 class="popup__section_label">Прикрепить файлы</h2>\n\t\t\t\t</div>\n\t\t\t</section>\n\t\t\t<footer class="popup__footer">\n\t\t\t\t<button class="popup__action" id="popupAction">Сохранить</button>\n\t\t\t</footer>\n\t\t'),e}}),Object.defineProperty(this,_createBackground,{writable:!0,value:function(){var t=document.createElement("span");return t.classList="popup__bacground",t.addEventListener("click",a.hide),t}}),Object.defineProperty(this,_save,{writable:!0,value:function(){var t=a.state,e=t.description,o=t.popup,s=t.parent,i=o.querySelector("#popupNameSection");i.value?e.save().then(function(t){var e={name:i.value,description:t.blocks};s.updateSection(e),a.state.data=e,a.hide()}).catch(function(t){alert("Saving failed: ",t)}):alert("Секция обязательно должна иметь имя!")}}),Object.defineProperty(this,_createEvents,{writable:!0,value:function(){var t=a.state.popup;t.querySelector("#popupClose").addEventListener("click",a.hide),t.querySelector("#popupAction").addEventListener("click",_classPrivateFieldLooseBase(a,_save)[_save]),t.querySelector("#popupNameSection").addEventListener("keydown",function(t){"Enter"==t.code&&_classPrivateFieldLooseBase(a,_save)[_save]()})}}),Object.defineProperty(this,_createDescriptionBlock,{writable:!0,value:function(){var t=a.state,e=(t.popup,t.data);a.state.description=new EditorJS({holder:"popupDescription",minHeight:100,tools:{list:{class:List,inlineToolbar:!0},header:{class:Header,shortcut:"CMD+SHIFT+H"}},placeholder:"Описание блока",data:{blocks:e.description}})}}),this.state.parent=e,this.state.body=document.querySelector("body"),this.state.data=Object.assign(this.state.data,o),this.state.popup=_classPrivateFieldLooseBase(this,_createPopup)[_createPopup](this.state.data),_classPrivateFieldLooseBase(this,_createEvents)[_createEvents](),this.state.bacground=_classPrivateFieldLooseBase(this,_createBackground)[_createBackground]()},_createPopup=_classPrivateFieldLooseKey("createPopup"),_createBackground=_classPrivateFieldLooseKey("createBackground"),_save=_classPrivateFieldLooseKey("save"),_createEvents=_classPrivateFieldLooseKey("createEvents"),_createDescriptionBlock=_classPrivateFieldLooseKey("createDescriptionBlock");