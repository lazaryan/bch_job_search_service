"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var o=t[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _classPrivateFieldLooseBase(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}var id=0;function _classPrivateFieldLooseKey(e){return"__private_"+id+++"_"+e}var LoadImage=function(){function e(){var t=this,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{action:void 0,blocks_load:void 0,path:"",status:!1,default_image:""};_classCallCheck(this,e),this.state={conf:{action:void 0,blocks_load:void 0,path:"",status:!1,default_image:""},action:void 0,blocks_load:void 0,default_src:[]},this.sendMessage=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"update",a=(arguments.length>1&&arguments[1],new XMLHttpRequest),o="/todo/update_user_photo/".concat(e);switch(a.open("POST",o,!0),e){case"update":var s=t.state.action.querySelector("#formUpdateUserImage"),i=new FormData(s);a.send(i);break;case"remove":a.send()}a.addEventListener("readystatechange",function(e){if(4!=a.readyState)return"";200==a.status?(console.log("IMAGE UPDATE"),console.log(a.responseText)):(console.log("ERROR send"),console.log(a.status+": "+a.statusText))})},Object.defineProperty(this,_getBlock,{writable:!0,value:function(e){return e?"object"==_typeof(e)?e:"string"==typeof e?document.querySelectorAll(e):void 0:void 0}}),Object.defineProperty(this,_getDefaultSrc,{writable:!0,value:function(){for(var e=t.state.blocks_load,a=0;a<e.length;a++)t.state.default_src.push(e[a].src)}}),Object.defineProperty(this,_createAction,{writable:!0,value:function(){var e=t.state.conf.status,a=t.state.action,o=document.createElement("form");o.action="#",o.id="formUpdateUserImage";var s='\n\t\t\t\t<input type="file" id="inpFileLoad" name="action_load_file"\n\t\t\t\t\taccept="image/x-png,image/gif,image/jpeg" style="display: none" />\n\t\t\t\t<label for="inpFileLoad" class="user__bth user__bth_action user__bth_margin">\n\t\t\t\t\t'.concat(e?"Изменить":"Добавить","\n\t\t\t\t</label>\n\t\t\t");if(o.innerHTML=s,a.appendChild(o),e){var i=document.createElement("button");i.classList="user__bth user__bth_remove user__bth_margin",i.id="inpFileRemove",i.innerHTML="Удалить",a.appendChild(i)}_classPrivateFieldLooseBase(t,_createEvents)[_createEvents](a)}}),Object.defineProperty(this,_createEvents,{writable:!0,value:function(e){var a=e.querySelector("#inpFileLoad"),o=e.querySelector("#inpFileRemove");a.addEventListener("change",function(e){var a=e.target.files[0],o=new FileReader;o.readAsDataURL(a),o.onloadend=function(){_classPrivateFieldLooseBase(this,_updateImage)[_updateImage](o.result),this.sendMessage("update",e.target.files[0]),_classPrivateFieldLooseBase(this,_clearAction)[_clearAction](),this.state.conf.status=!0,_classPrivateFieldLooseBase(this,_createAction)[_createAction]()}.bind(t)}),o&&o.addEventListener("click",function(){_classPrivateFieldLooseBase(t,_remove)[_remove]()})}}),Object.defineProperty(this,_updateImage,{writable:!0,value:function(e){for(var a=t.state.blocks_load,o=0;o<a.length;o++)a[o].src=e}}),Object.defineProperty(this,_clearAction,{writable:!0,value:function(){t.state.action.innerHTML=""}}),Object.defineProperty(this,_remove,{writable:!0,value:function(){for(var e=t.state,a=e.blocks_load,o=e.default_src,s=0;s<a.length;s++)a[s].src!=o[s]?a[s].src=o[s]:a[s].src=t.state.conf.default_image;_classPrivateFieldLooseBase(t,_clearAction)[_clearAction](),t.state.conf.status=!1,_classPrivateFieldLooseBase(t,_createAction)[_createAction](),t.sendMessage("remove")}}),this.state.conf=Object.assign(this.state.conf,a),this.init(a.action,a.blocks_load)}return _createClass(e,[{key:"init",value:function(e,t){this.state.action=_classPrivateFieldLooseBase(this,_getBlock)[_getBlock](e)[0],this.state.blocks_load=_classPrivateFieldLooseBase(this,_getBlock)[_getBlock](t),_classPrivateFieldLooseBase(this,_getDefaultSrc)[_getDefaultSrc](),_classPrivateFieldLooseBase(this,_createAction)[_createAction]()}}]),e}(),_getBlock=_classPrivateFieldLooseKey("getBlock"),_getDefaultSrc=_classPrivateFieldLooseKey("getDefaultSrc"),_createAction=_classPrivateFieldLooseKey("createAction"),_createEvents=_classPrivateFieldLooseKey("createEvents"),_updateImage=_classPrivateFieldLooseKey("updateImage"),_clearAction=_classPrivateFieldLooseKey("clearAction"),_remove=_classPrivateFieldLooseKey("remove");