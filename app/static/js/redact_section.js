"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _classPrivateFieldLooseBase(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}var id=0;function _classPrivateFieldLooseKey(t){return"__private_"+id+++"_"+t}var Section=function t(e,s,n,a){var o=this,i=e.name,c=e.description;_classCallCheck(this,t),this.state={name:"",description:[],id:0,special_id:0,section:void 0,parent:void 0},Object.defineProperty(this,_createBlock,{writable:!0,value:function(){var t=o.state,e=t.name,s=t.description,n=t.parent,a=t.id,i=t.special_id,c=document.createElement("div");return c.classList="card card_radius card_margin card_no-padding",c.id="section".concat(i),c.style.padding="0",c.innerHTML='\n\t\t\t<header class="section__header">\n\t\t\t\t<div class="section__title js-sectionTitle">'.concat(e||"",'</div>\n\t\t\t\t<div class="section__header_action">\n\t\t\t\t\t<button class="section__header_bth js-changeSection">Изменить</button>\n\t\t\t\t\t<button class="section__header_bth js-removeSection">Удалить</button>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t\t<section class="section__body js-sectionBody"></section>\n\t\t'),s.length?new ParseDescription({el:c.querySelector(".js-sectionBody"),obj:s}):c.querySelector(".js-sectionBody").innerHTML='\n\t\t\t\t<h2 class="section-body__title section-body__title_center">Секция пустая!</h2>\n\t\t\t\t<p class="section-body__text section-body__text_center">Добавьте ей описания</p>\n\t\t\t\t<p class="section-body__text section-body__text_center">Чтобы стало понятно, какое это ваше личное достижение</p>\n\t\t\t',c.querySelector(".js-changeSection").addEventListener("click",function(){return n.showPopup(a,o.state.section)}),c.querySelector(".js-removeSection").addEventListener("click",function(){return n.removeSection(a,o.state.section)}),c}}),this.update=function(t){o.state.name=t.name||o.state.name,o.state.description=t.description||o.state.description;var e=o.state.section;e.querySelector(".js-sectionTitle").innerHTML=o.state.name,e.querySelector(".js-sectionBody").innerHTML="",new ParseDescription({el:e.querySelector(".js-sectionBody"),obj:o.state.description})},this.state.name=i,this.state.description=c,this.state.id=s,this.state.parent=a,this.state.special_id=n,this.state.section=_classPrivateFieldLooseBase(this,_createBlock)[_createBlock]()},_createBlock=_classPrivateFieldLooseKey("createBlock"),SectionManager=function t(e){var s=this,n=e.body,a=e.action_add,o=e.nav,i=e.sections,c=e.save;if(_classCallCheck(this,t),this.state={body:void 0,add_action:void 0,nav:void 0,banner:void 0,sectionsData:[],popup:void 0,sections:[],save_bth:void 0,action_id:-1},this.showPopup=function(t,e){for(var n=s.state,a=n.popup,o=n.sections,i=-1,c=0;c<o.length;c++)if(o[c].state.section==e){i=c;break}var r=s.state.sectionsData[i];s.state.action_id=i,a.update(r),a.show()},this.updateSection=function(t){var e=s.state,n=e.action_id,a=e.sections,o=e.nav;s.state.sectionsData[n]=t,a[n].update(t),console.log("!11111!!!!!");var i=a[n].state.special_id;console.log(t),o.querySelector("#linkToSection".concat(i)).innerHTML=t.name,console.log("a2222"),s.state.action_id=-1},this.removeSection=function(t,e){var n=s.state,a=n.body,o=n.sections,i=n.nav;if(confirm("Вы уверены, что хотите удалить данную секцию?")){for(var c=-1,r=0;r<o.length;r++)if(o[r].state.section==e){c=r;break}var l=o[c].state.special_id,d=i.querySelector("#linkToSection".concat(l));i.removeChild(d),a.removeChild(o[c].state.section),s.state.sections.splice(c,1),s.state.sectionsData.splice(c,1),s.state.sections.length||(_classPrivateFieldLooseBase(s,_appendBanner)[_appendBanner](),s.state.save_bth.style.display="none")}},this.removeLastSection=function(){var t=s.state,e=t.body,n=t.sections,a=t.nav,o=n.length-1,i=n[o].state.special_id,c=a.querySelector("#linkToSection".concat(i));a.removeChild(c),e.removeChild(n[o].state.section),s.state.sections.splice(o,1),s.state.sectionsData.splice(o,1),s.state.sections.length||(_classPrivateFieldLooseBase(s,_appendBanner)[_appendBanner](),s.state.save_bth.style.display="none")},Object.defineProperty(this,_getBlock,{writable:!0,value:function(t){return t?"object"==_typeof(t)?t:"string"==typeof t?document.querySelector(t):void 0:void 0}}),Object.defineProperty(this,_appendBanner,{writable:!0,value:function(){var t=document.createElement("div");t.classList="card card_radius card_center",t.style.height="300px",t.innerHTML='\n\t\t<h3 class="resume__card_no-content_title">\n\t\t\tВ данный момент секции с информацией отсутсвуют\n\t\t</h3>\n\t\t<p class="resume__card_no-content_text">Создайте новую карточку</p>\n\t\t<p class="resume__card_no-content_text">Опишите свои навыки и умения</p>',s.state.banner=t,s.state.body.appendChild(t)}}),this.state.popup=new Popup(this),this.state.body=_classPrivateFieldLooseBase(this,_getBlock)[_getBlock](n),this.state.nav=_classPrivateFieldLooseBase(this,_getBlock)[_getBlock](o),this.state.add_action=_classPrivateFieldLooseBase(this,_getBlock)[_getBlock](a),this.state.save_bth=_classPrivateFieldLooseBase(this,_getBlock)[_getBlock](c),"string"==typeof i&&(i=fixJsObj(i)),i.forEach(function(t){s.state.sectionsData.push(t)}),this.state.add_action&&this.state.add_action.addEventListener("click",function(){var t=s.state.popup;s.state.banner&&(s.state.banner.parentNode.removeChild(s.state.banner),s.state.banner=void 0),s.state.save_bth.style.display="";var e={name:"",description:[]},n=0;s.state.sections.length&&(n=s.state.sections[s.state.sections.length-1].state.special_id+1);var a=new Section(e,s.state.sections.length,n,s);s.state.sections.push(a),s.state.sectionsData.push(e),s.state.body.appendChild(a.state.section),s.state.action_id=s.state.sections.length-1;var o=document.createElement("a");o.classList="navigation__item",o.id="linkToSection".concat(n),o.href="#section".concat(n),s.state.nav.appendChild(o),t.update(e),t.show()}),this.state.sectionsData.length){var r=-1;this.state.sectionsData.forEach(function(t){r+=1;var e=new Section(t,s.state.sections.length,r,s);s.state.sections.push(e),s.state.body.appendChild(e.state.section);var n=document.createElement("a");n.classList="navigation__item",n.id="linkToSection".concat(r),n.href="#section".concat(r),n.innerHTML=t.name,s.state.nav.appendChild(n)})}else _classPrivateFieldLooseBase(this,_appendBanner)[_appendBanner](),this.state.save_bth.style.display="none";this.state.save_bth&&this.state.save_bth.addEventListener("click",function(){var t=new XMLHttpRequest;t.open("POST","/todo/edit_sections",!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(s.state.sectionsData)),t.addEventListener("readystatechange",function(e){if(4!=t.readyState)return"";200==t.status?(console.log(t.responseText),alert("Обновления успешно сохранены!")):(console.log("ERROR send"),console.log(t.status+": "+t.statusText))})})},_getBlock=_classPrivateFieldLooseKey("getBlock"),_appendBanner=_classPrivateFieldLooseKey("appendBanner");